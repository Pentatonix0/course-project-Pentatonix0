# STRIDE для Quiz Builder

Таблица: Поток/Элемент → STRIDE-угроза → Контроль → Ссылка на NFR → Проверка

| Поток/Элемент                       | STRIDE | Угроза (кратко)                                           | Контроль (меры)                                                                          | Ссылка на NFR                      | Как проверить                                                               |
| ----------------------------------- | ------ | --------------------------------------------------------- | ---------------------------------------------------------------------------------------- | ---------------------------------- | --------------------------------------------------------------------------- |
| **F1** `/auth/register`             | S      | Фейковые регистрации/боты; дубликаты email                | Уникальность email; хэш пароля **Argon2id** / **bcrypt** с параметрами по NFR            | NFR-SEC-01                         | Юнит-тесты хэширования; ревью схем (unique idx), фиксация параметров hash   |
| **F2** `/auth/login`                | T/R    | Брутфорс, подбор пароля, фиктивные ошибки                 | Rate-limit login (≤5 req/min/IP), account lockout 15m после 10 ошибок; унификация ошибок | NFR-SEC-04, NFR-SEC-10, NFR-SEC-08 | Интеграционные тесты 429; каплог: `account_lockout`; ответы 401 без деталей |
| **F2** `/auth/login`                | I      | Утечка токена/PII в сообщениях об ошибках                 | Маскирование чувствительных данных в логах; стандартные ответы                           | NFR-SEC-12, NFR-SEC-08             | Контроль логов: нет JWT/секретов; e2e 401/500 без «Traceback»               |
| **F3** `/auth/me`                   | S      | Подмена идентичности (подписан неверным ключом/просрочен) | Подпись HS256, проверка `exp/iat/iss/sub`, отказ по просрочке                            | NFR-SEC-02                         | Тесты exp/alg; проверка TTL access=15m                                      |
| **F4** `CRUD /users`                | E      | Повышение привилегий (редактирование чужих)               | Guards: owner-only / role-checks; фильтрация по owner_id                                 | NFR-SEC-03                         | Интеграционные тесты owner→403; OpenAPI security для POST/PATCH/DELETE      |
| **F5** `POST /quizzes`              | T      | Лишние поля/типовые несоответствия (инъекции через поля)  | DTO с `extra=forbid`; строгая валидация типов                                            | NFR-SEC-05                         | Негативные тесты 422 + сверка OpenAPI                                       |
| **F6** `GET /quizzes*`              | D      | DoS через тяжёлые запросы                                 | Пагинация/лимиты; таймауты ответа; индексы                                               | NFR-SEC-06, NFR-SEC-08             | Тесты пагинации; профилирование p95                                         |
| **F7** `PATCH/DELETE /quizzes/{id}` | R      | Отрицание изменений                                       | Аудит-логирование security-событий (who/when/what)                                       | NFR-SEC-10                         | Caplog: события CRUD; поля actor, resource                                  |
| **F8** `DB.Users`                   | I      | Слабое хэширование паролей                                | **Argon2id** (m≈64MB,t≥3,p≥1) или **bcrypt** cost≥12                                     | NFR-SEC-01                         | Юнит-тесты параметров hash; проверка алгоритма                              |
| **F9** `JWT`                        | I/T    | Долгий TTL; отсутствие ротации секрета                    | Access=15m, Refresh=7d; ротация секрета ≤90d; ревок по смене пароля                      | NFR-SEC-02, NFR-SEC-06             | Тесты конфигов; проверка `exp`; регламент ротации                           |
| **F10** `Secrets/Config`            | I/S    | Коммиты секретов в Git                                    | pre-commit detect-private-key; **gitleaks** в CI, 0 High                                 | NFR-SEC-06                         | CI: 0 findings; pre-commit проходит                                         |

> Ссылки на NFR — см. `docs/security-nfr/NFR.md` (NFR-SEC-01…NFR-SEC-12).
